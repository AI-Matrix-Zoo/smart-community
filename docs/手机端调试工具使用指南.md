# 手机端调试工具使用指南

## 问题背景

用户反馈手机端无法正常获取物品列表，显示"获取列表失败"，但电脑端可以正常显示。为了更好地诊断手机端的具体问题，我们创建了专门的调试工具。

## 调试工具访问

### 方式1：通过主域名访问
```
http://123.56.64.5/mobile-debug.html
```

### 方式2：通过前端服务访问
```
http://123.56.64.5:5174/mobile-debug.html
```

## 调试工具功能

### 1. 环境信息显示
- User Agent（浏览器信息）
- 屏幕尺寸和视口尺寸
- 当前访问URL
- API基础地址配置
- 网络连接类型

### 2. 网络连接测试
- **测试基础连接**：测试到后端服务器的基础连接
- **测试CORS**：检查跨域资源共享配置是否正确

### 3. API功能测试
- **测试市场API**：直接测试 `/api/market` 接口
- **测试建议API**：直接测试 `/api/suggestions` 接口  
- **测试带认证的API**：测试需要登录token的API请求

### 4. 详细错误日志
- 实时显示所有测试过程中的详细日志
- 包含请求URL、响应状态、响应头、错误信息等
- 支持清空日志功能

## 使用步骤

### 第一步：访问调试工具
用手机浏览器打开调试工具页面，首先查看**环境信息**部分，确认：
- API基础地址是否正确
- 网络连接类型是否正常

### 第二步：测试网络连接
1. 点击"测试基础连接"按钮
2. 点击"测试CORS"按钮
3. 查看连接日志，确认网络连接是否正常

### 第三步：测试API功能
1. 点击"测试市场API"按钮
2. 点击"测试建议API"按钮
3. 如果已登录，点击"测试带认证的API"按钮
4. 查看API日志，分析具体的错误信息

### 第四步：分析结果
根据测试结果判断问题所在：

#### 如果基础连接失败
- 检查网络连接
- 确认服务器是否正常运行
- 检查防火墙设置

#### 如果CORS测试失败
- 后端CORS配置问题
- 需要检查服务器端的跨域设置

#### 如果API测试失败
- 查看具体的HTTP状态码
- 分析响应内容和错误信息
- 检查请求头和参数

## 常见问题诊断

### 问题1：网络连接超时
**现象**：基础连接测试显示超时错误
**可能原因**：
- 手机网络不稳定
- 服务器防火墙阻止了手机端访问
- DNS解析问题

**解决方案**：
- 尝试切换网络（WiFi/移动数据）
- 检查服务器防火墙配置
- 尝试使用IP地址直接访问

### 问题2：CORS错误
**现象**：CORS预检失败，出现跨域错误
**可能原因**：
- 后端CORS配置不完整
- 手机端请求头与电脑端不同

**解决方案**：
- 检查后端CORS配置
- 添加手机端特有的请求头支持

### 问题3：API返回数据但前端显示失败
**现象**：API测试成功，但应用中仍显示获取失败
**可能原因**：
- 前端JavaScript处理逻辑问题
- 数据格式解析错误
- 异步处理问题

**解决方案**：
- 检查前端控制台日志
- 对比API返回数据格式
- 检查前端错误处理逻辑

## 后端健康检查

我们还添加了健康检查端点：
```
GET http://123.56.64.5:3000/health
```

返回格式：
```json
{
  "status": "ok",
  "timestamp": "2025-06-03T11:09:30.042Z",
  "uptime": 12345.67
}
```

## 前端调试增强

在MarketPage中添加了详细的控制台日志：
- API请求开始时的环境信息
- API响应的数据类型和内容
- 详细的错误信息和堆栈跟踪

在手机端访问时，可以通过以下方式查看控制台日志：
1. **Chrome移动版**：通过Chrome DevTools远程调试
2. **Safari移动版**：通过Safari Web Inspector
3. **其他浏览器**：使用调试工具页面的日志功能

## 技术实现

### 调试工具特性
- 纯HTML/JavaScript实现，无需额外依赖
- 响应式设计，适配手机屏幕
- 实时日志显示，支持滚动查看
- 错误分类显示（成功/错误/信息/警告）
- 全局错误捕获，包括未处理的Promise错误

### API地址动态配置
```javascript
function getApiBaseUrl() {
    const hostname = window.location.hostname;
    if (hostname === 'localhost' || hostname === '127.0.0.1') {
        return 'http://localhost:3000';
    } else {
        return `http://${hostname}:3000`;
    }
}
```

### 错误处理增强
- 捕获网络错误、解析错误、超时错误
- 提供用户友好的错误信息
- 记录详细的技术错误信息用于调试

## 使用建议

1. **首次使用**：建议先在电脑端测试调试工具，确认功能正常
2. **对比测试**：同时在电脑端和手机端运行相同测试，对比结果
3. **网络环境**：在不同网络环境下测试（WiFi、4G、5G）
4. **浏览器对比**：在不同手机浏览器中测试
5. **日志保存**：重要的错误日志可以截图保存，便于后续分析

通过这个调试工具，我们可以快速定位手机端访问问题的根本原因，并针对性地进行修复。 