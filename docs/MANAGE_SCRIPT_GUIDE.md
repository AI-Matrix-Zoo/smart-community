# manage.sh è„šæœ¬ä½¿ç”¨æŒ‡å—

## æ¦‚è¿°

`manage.sh` æ˜¯æ™ºæ…§å°åŒºç”Ÿæ´»å¹³å°çš„ç»Ÿä¸€ç®¡ç†è„šæœ¬ï¼Œæ”¯æŒå¼€å‘ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒçš„å®Œæ•´ç®¡ç†ï¼ŒåŒ…æ‹¬PM2è¿›ç¨‹ç®¡ç†ã€éƒ¨ç½²æµç¨‹ç­‰ã€‚

## åŠŸèƒ½ç‰¹æ€§

- ğŸ”§ **å¼€å‘ç¯å¢ƒç®¡ç†**ï¼šå¯åŠ¨ã€åœæ­¢å¼€å‘æœåŠ¡å™¨
- ğŸš€ **ç”Ÿäº§ç¯å¢ƒç®¡ç†**ï¼šå®Œæ•´çš„PM2è¿›ç¨‹ç®¡ç†
- ğŸ“¦ **éƒ¨ç½²è‡ªåŠ¨åŒ–**ï¼šä¸€é”®éƒ¨ç½²å‰ç«¯ã€åç«¯æˆ–å®Œæ•´ç³»ç»Ÿ
- ğŸ“Š **çŠ¶æ€ç›‘æ§**ï¼šå®æ—¶æŸ¥çœ‹æœåŠ¡çŠ¶æ€å’Œæ—¥å¿—
- ğŸ” **å¥åº·æ£€æŸ¥**ï¼šè‡ªåŠ¨æ£€æµ‹æœåŠ¡å¥åº·çŠ¶æ€

## å¿«é€Ÿå¼€å§‹

### å¼€å‘ç¯å¢ƒ

```bash
# å¿«é€Ÿå¯åŠ¨å¼€å‘ç¯å¢ƒï¼ˆæ¨èï¼‰
./manage.sh quick-start

# æˆ–è€…åˆ†æ­¥æ“ä½œ
./manage.sh install    # å®‰è£…ä¾èµ–
./manage.sh build      # æ„å»ºé¡¹ç›®
./manage.sh dev        # å¯åŠ¨å¼€å‘ç¯å¢ƒ
```

### ç”Ÿäº§ç¯å¢ƒ

```bash
# ä½¿ç”¨PM2å¯åŠ¨ç”Ÿäº§ç¯å¢ƒ
./manage.sh pm2:start

# æŸ¥çœ‹PM2çŠ¶æ€
./manage.sh pm2:status

# æŸ¥çœ‹PM2æ—¥å¿—
./manage.sh pm2:logs
```

## å‘½ä»¤è¯¦è§£

### å¼€å‘ç¯å¢ƒå‘½ä»¤

#### `install` - å®‰è£…ä¾èµ–
```bash
./manage.sh install                    # å®‰è£…å‰åç«¯ä¾èµ–
./manage.sh install --backend-only     # ä»…å®‰è£…åç«¯ä¾èµ–
./manage.sh install --frontend-only    # ä»…å®‰è£…å‰ç«¯ä¾èµ–
```

#### `build` - æ„å»ºé¡¹ç›®
```bash
./manage.sh build                      # æ„å»ºå‰åç«¯é¡¹ç›®
./manage.sh build --backend-only       # ä»…æ„å»ºåç«¯
./manage.sh build --frontend-only      # ä»…æ„å»ºå‰ç«¯
```

#### `dev` - å¯åŠ¨å¼€å‘ç¯å¢ƒ
```bash
./manage.sh dev                        # å¯åŠ¨å‰åç«¯å¼€å‘æœåŠ¡å™¨
./manage.sh dev --backend-only         # ä»…å¯åŠ¨åç«¯å¼€å‘æœåŠ¡å™¨
./manage.sh dev --frontend-only        # ä»…å¯åŠ¨å‰ç«¯å¼€å‘æœåŠ¡å™¨
```

#### `quick-start` - å¿«é€Ÿå¯åŠ¨
```bash
./manage.sh quick-start                # å¿«é€Ÿå¯åŠ¨å¼€å‘ç¯å¢ƒå¹¶è¿›è¡Œå¥åº·æ£€æŸ¥
```
- è‡ªåŠ¨å¤„ç†ç«¯å£å ç”¨
- å¯åŠ¨å‰åç«¯æœåŠ¡
- è¿›è¡Œå¥åº·æ£€æŸ¥
- æ˜¾ç¤ºè®¿é—®åœ°å€å’Œä½¿ç”¨æç¤º

### ç”Ÿäº§ç¯å¢ƒå‘½ä»¤ (PM2)

#### `pm2:start` - å¯åŠ¨PM2æœåŠ¡
```bash
./manage.sh pm2:start                  # ä½¿ç”¨PM2å¯åŠ¨åç«¯æœåŠ¡
```
- è‡ªåŠ¨æ£€æŸ¥å¹¶å®‰è£…PM2
- æ”¯æŒecosystem.config.jsé…ç½®æ–‡ä»¶
- å‰ç«¯ç”±Nginxæä¾›é™æ€æ–‡ä»¶æœåŠ¡

#### `pm2:stop` - åœæ­¢PM2æœåŠ¡
```bash
./manage.sh pm2:stop                   # åœæ­¢PM2ç®¡ç†çš„æœåŠ¡
```

#### `pm2:restart` - é‡å¯PM2æœåŠ¡
```bash
./manage.sh pm2:restart                # é‡å¯PM2ç®¡ç†çš„æœåŠ¡
```
- å¦‚æœæœåŠ¡æœªè¿è¡Œï¼Œä¼šè‡ªåŠ¨å¯åŠ¨

#### `pm2:reload` - é‡è½½PM2æœåŠ¡ï¼ˆé›¶åœæœºï¼‰
```bash
./manage.sh pm2:reload                 # é›¶åœæœºé‡è½½æœåŠ¡
```
- é€‚ç”¨äºç”Ÿäº§ç¯å¢ƒæ›´æ–°

#### `pm2:status` - æŸ¥çœ‹PM2çŠ¶æ€
```bash
./manage.sh pm2:status                 # æ˜¾ç¤ºPM2è¿›ç¨‹çŠ¶æ€è¡¨
```

#### `pm2:logs` - æŸ¥çœ‹PM2æ—¥å¿—
```bash
./manage.sh pm2:logs                   # æŸ¥çœ‹æ‰€æœ‰PM2æ—¥å¿—
./manage.sh pm2:logs --backend-only    # ä»…æŸ¥çœ‹åç«¯æ—¥å¿—
```

#### `pm2:monit` - PM2ç›‘æ§ç•Œé¢
```bash
./manage.sh pm2:monit                  # å¯åŠ¨PM2å®æ—¶ç›‘æ§ç•Œé¢
```

#### `pm2:delete` - åˆ é™¤PM2æœåŠ¡
```bash
./manage.sh pm2:delete                 # åˆ é™¤PM2ç®¡ç†çš„æœåŠ¡é…ç½®
```
- éœ€è¦ç¡®è®¤æ“ä½œ

#### `pm2:save` - ä¿å­˜PM2è¿›ç¨‹åˆ—è¡¨
```bash
./manage.sh pm2:save                   # ä¿å­˜å½“å‰PM2è¿›ç¨‹åˆ—è¡¨
```

#### `pm2:resurrect` - æ¢å¤PM2è¿›ç¨‹åˆ—è¡¨
```bash
./manage.sh pm2:resurrect              # æ¢å¤ä¿å­˜çš„PM2è¿›ç¨‹åˆ—è¡¨
```

### éƒ¨ç½²å‘½ä»¤

#### `deploy` - å®Œæ•´éƒ¨ç½²æµç¨‹
```bash
./manage.sh deploy                     # å®Œæ•´éƒ¨ç½²æµç¨‹
```
åŒ…å«ä»¥ä¸‹æ­¥éª¤ï¼š
1. æ£€æŸ¥GitçŠ¶æ€
2. æ‹‰å–æœ€æ–°ä»£ç 
3. å®‰è£…ä¾èµ–
4. æ„å»ºé¡¹ç›®
5. éƒ¨ç½²å‰ç«¯ï¼ˆå¤åˆ¶åˆ°Nginxç›®å½•ï¼‰
6. éƒ¨ç½²åç«¯ï¼ˆPM2é‡å¯ï¼‰
7. å¥åº·æ£€æŸ¥

#### `deploy:frontend` - ä»…éƒ¨ç½²å‰ç«¯
```bash
./manage.sh deploy:frontend            # ä»…éƒ¨ç½²å‰ç«¯
```
- æ„å»ºå‰ç«¯é¡¹ç›®
- å¤åˆ¶åˆ°Nginxç›®å½•
- é‡è½½Nginxé…ç½®

#### `deploy:backend` - ä»…éƒ¨ç½²åç«¯
```bash
./manage.sh deploy:backend             # ä»…éƒ¨ç½²åç«¯
```
- æ„å»ºåç«¯é¡¹ç›®
- é‡å¯PM2æœåŠ¡

### é€šç”¨å‘½ä»¤

#### `stop` - åœæ­¢æ‰€æœ‰æœåŠ¡
```bash
./manage.sh stop                       # åœæ­¢å¼€å‘ç¯å¢ƒå’ŒPM2æœåŠ¡
```

#### `clean` - æ¸…ç†é¡¹ç›®
```bash
./manage.sh clean                      # æ¸…ç†æ„å»ºæ–‡ä»¶å’Œæ—¥å¿—
```
- å¯é€‰æ‹©æ˜¯å¦åˆ é™¤node_modules

#### `status` - æŸ¥çœ‹æœåŠ¡çŠ¶æ€
```bash
./manage.sh status                     # æŸ¥çœ‹æ‰€æœ‰æœåŠ¡çŠ¶æ€
```
æ˜¾ç¤ºï¼š
- å¼€å‘ç¯å¢ƒçŠ¶æ€ï¼ˆç«¯å£å ç”¨æƒ…å†µï¼‰
- PM2æœåŠ¡çŠ¶æ€
- NginxæœåŠ¡çŠ¶æ€

#### `logs` - æŸ¥çœ‹æ—¥å¿—
```bash
./manage.sh logs                       # æŸ¥çœ‹æœåŠ¡æ—¥å¿—
./manage.sh logs --backend-only        # ä»…æŸ¥çœ‹åç«¯æ—¥å¿—
./manage.sh logs --frontend-only       # ä»…æŸ¥çœ‹å‰ç«¯æ—¥å¿—
```

#### `health` - å¥åº·æ£€æŸ¥
```bash
./manage.sh health                     # æ‰§è¡Œå¥åº·æ£€æŸ¥
```
æ£€æŸ¥ï¼š
- åç«¯APIå¥åº·çŠ¶æ€
- å‰ç«¯æœåŠ¡å¯è®¿é—®æ€§

#### `test` - è¿è¡Œæµ‹è¯•
```bash
./manage.sh test                       # è¿è¡Œå‰åç«¯æµ‹è¯•
./manage.sh test --backend-only        # ä»…è¿è¡Œåç«¯æµ‹è¯•
./manage.sh test --frontend-only       # ä»…è¿è¡Œå‰ç«¯æµ‹è¯•
```

#### `test-services` - æœåŠ¡åŠŸèƒ½æµ‹è¯•
```bash
./manage.sh test-services              # è¿è¡ŒæœåŠ¡åŠŸèƒ½æµ‹è¯•
```

## ä½¿ç”¨åœºæ™¯

### æ—¥å¸¸å¼€å‘

```bash
# å¼€å§‹å¼€å‘
./manage.sh quick-start

# æŸ¥çœ‹çŠ¶æ€
./manage.sh status

# æŸ¥çœ‹æ—¥å¿—
./manage.sh logs

# åœæ­¢æœåŠ¡
./manage.sh stop
```

### ç”Ÿäº§éƒ¨ç½²

```bash
# é¦–æ¬¡éƒ¨ç½²
./manage.sh deploy

# ä»…æ›´æ–°å‰ç«¯
./manage.sh deploy:frontend

# ä»…æ›´æ–°åç«¯
./manage.sh deploy:backend

# æŸ¥çœ‹PM2çŠ¶æ€
./manage.sh pm2:status

# æŸ¥çœ‹PM2æ—¥å¿—
./manage.sh pm2:logs
```

### æ•…éšœæ’æŸ¥

```bash
# æŸ¥çœ‹æ‰€æœ‰æœåŠ¡çŠ¶æ€
./manage.sh status

# å¥åº·æ£€æŸ¥
./manage.sh health

# æŸ¥çœ‹æ—¥å¿—
./manage.sh logs

# é‡å¯PM2æœåŠ¡
./manage.sh pm2:restart
```

## æ³¨æ„äº‹é¡¹

1. **æƒé™è¦æ±‚**ï¼š
   - éƒ¨ç½²å‘½ä»¤éœ€è¦sudoæƒé™ï¼ˆç”¨äºæ“ä½œNginxï¼‰
   - PM2å‘½ä»¤å¯èƒ½éœ€è¦é€‚å½“çš„ç”¨æˆ·æƒé™

2. **ç«¯å£å ç”¨**ï¼š
   - å¼€å‘ç¯å¢ƒï¼šå‰ç«¯5173ï¼Œåç«¯3000
   - ç”Ÿäº§ç¯å¢ƒï¼šåç«¯3000ï¼Œå‰ç«¯ç”±Nginxæä¾›ï¼ˆ80/443ï¼‰

3. **æ–‡ä»¶è·¯å¾„**ï¼š
   - è„šæœ¬ä¼šè‡ªåŠ¨æ£€æµ‹é¡¹ç›®ç»“æ„
   - æ—¥å¿—æ–‡ä»¶å­˜å‚¨åœ¨`logs/`ç›®å½•
   - è¿è¡Œæ—¶æ–‡ä»¶å­˜å‚¨åœ¨`runtime/`ç›®å½•

4. **ä¾èµ–è¦æ±‚**ï¼š
   - Node.js 18+
   - npm
   - PM2ï¼ˆè„šæœ¬ä¼šè‡ªåŠ¨å®‰è£…ï¼‰
   - Nginxï¼ˆç”¨äºç”Ÿäº§ç¯å¢ƒï¼‰

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **ç«¯å£è¢«å ç”¨**ï¼š
   ```bash
   ./manage.sh stop    # åœæ­¢æ‰€æœ‰æœåŠ¡
   ./manage.sh status  # æ£€æŸ¥çŠ¶æ€
   ```

2. **PM2æœåŠ¡å¼‚å¸¸**ï¼š
   ```bash
   ./manage.sh pm2:status   # æŸ¥çœ‹PM2çŠ¶æ€
   ./manage.sh pm2:logs     # æŸ¥çœ‹PM2æ—¥å¿—
   ./manage.sh pm2:restart  # é‡å¯PM2æœåŠ¡
   ```

3. **å‰ç«¯éƒ¨ç½²å¤±è´¥**ï¼š
   ```bash
   ./manage.sh build --frontend-only  # é‡æ–°æ„å»ºå‰ç«¯
   ./manage.sh deploy:frontend        # é‡æ–°éƒ¨ç½²å‰ç«¯
   ```

4. **å¥åº·æ£€æŸ¥å¤±è´¥**ï¼š
   ```bash
   ./manage.sh status  # æŸ¥çœ‹æœåŠ¡çŠ¶æ€
   ./manage.sh logs    # æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
   ```

### æ—¥å¿—ä½ç½®

- å¼€å‘ç¯å¢ƒæ—¥å¿—ï¼š`logs/backend.log`, `logs/frontend.log`
- PM2æ—¥å¿—ï¼šé€šè¿‡`./manage.sh pm2:logs`æŸ¥çœ‹
- Nginxæ—¥å¿—ï¼š`/var/log/nginx/`

## æœ€ä½³å®è·µ

1. **å¼€å‘æµç¨‹**ï¼š
   ```bash
   ./manage.sh quick-start  # å¼€å§‹å¼€å‘
   # è¿›è¡Œå¼€å‘å·¥ä½œ
   ./manage.sh test         # è¿è¡Œæµ‹è¯•
   ./manage.sh stop         # ç»“æŸå¼€å‘
   ```

2. **éƒ¨ç½²æµç¨‹**ï¼š
   ```bash
   git add . && git commit -m "æ›´æ–°å†…å®¹"
   git push origin main
   ./manage.sh deploy       # éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ
   ./manage.sh health       # éªŒè¯éƒ¨ç½²
   ```

3. **ç›‘æ§ç»´æŠ¤**ï¼š
   ```bash
   ./manage.sh pm2:save     # å®šæœŸä¿å­˜PM2é…ç½®
   ./manage.sh status       # å®šæœŸæ£€æŸ¥çŠ¶æ€
   ./manage.sh health       # å®šæœŸå¥åº·æ£€æŸ¥
   ```

---

**æç¤º**ï¼šä½¿ç”¨`./manage.sh --help`å¯ä»¥éšæ—¶æŸ¥çœ‹å‘½ä»¤å¸®åŠ©ä¿¡æ¯ã€‚ 