# æ™ºæ…§å°åŒºç”Ÿæ´»å¹³å° - çº¿ä¸Šéƒ¨ç½²æŒ‡å—

## ğŸ“… æ›´æ–°æ—¶é—´
2024-06-03

## ğŸ¯ éƒ¨ç½²æ¦‚è¿°

æœ¬æŒ‡å—å°†å¸®åŠ©æ‚¨å°†æ™ºæ…§å°åŒºç”Ÿæ´»å¹³å°éƒ¨ç½²åˆ°çº¿ä¸Šç¯å¢ƒã€‚æˆ‘ä»¬æ¨èä½¿ç”¨ Render.com ä½œä¸ºéƒ¨ç½²å¹³å°ï¼Œå®ƒæä¾›å…è´¹çš„æ‰˜ç®¡æœåŠ¡ï¼Œéå¸¸é€‚åˆä¸­å°å‹é¡¹ç›®ã€‚

### ğŸ—ï¸ éƒ¨ç½²æ¶æ„
- **å‰ç«¯**: Render Static Site (Vue.jsæ„å»ºåçš„é™æ€æ–‡ä»¶)
- **åç«¯**: Render Web Service (Node.js/Express)
- **æ•°æ®åº“**: SQLite (æ–‡ä»¶å­˜å‚¨)
- **é‚®ä»¶æœåŠ¡**: QQé‚®ç®± SMTP
- **çŸ­ä¿¡æœåŠ¡**: é˜¿é‡Œäº‘SMS

## ğŸ“‹ å‡†å¤‡å·¥ä½œ

### 1. è´¦æˆ·å‡†å¤‡
- GitHubè´¦æˆ· (ç”¨äºä»£ç æ‰˜ç®¡å’Œè‡ªåŠ¨éƒ¨ç½²)
- Render.comè´¦æˆ· (å…è´¹æ³¨å†Œ)
- QQé‚®ç®± (ç”¨äºé‚®ä»¶éªŒè¯ç )
- é˜¿é‡Œäº‘è´¦æˆ· (ç”¨äºçŸ­ä¿¡æœåŠ¡)

### 2. ç¯å¢ƒå˜é‡å‡†å¤‡
åœ¨éƒ¨ç½²å‰ï¼Œè¯·å‡†å¤‡ä»¥ä¸‹ç¯å¢ƒå˜é‡ï¼š

```bash
# åç«¯ç¯å¢ƒå˜é‡
NODE_ENV=production
PORT=3000
JWT_SECRET=your-super-secret-jwt-key-change-in-production
JWT_EXPIRES_IN=7d
DATABASE_PATH=./data/smart-community.db
FRONTEND_URL=https://your-frontend-url.onrender.com

# é‚®ç®±æœåŠ¡é…ç½®
EMAIL_HOST=smtp.qq.com
EMAIL_PORT=587
EMAIL_SECURE=false
EMAIL_USER=your-qq-email@qq.com
EMAIL_PASS=your-qq-smtp-password
EMAIL_FROM=your-qq-email@qq.com
EMAIL_ENABLED=true

# çŸ­ä¿¡æœåŠ¡é…ç½®
SMS_ENABLED=true
SMS_PROVIDER=aliyun
ALIBABA_CLOUD_ACCESS_KEY_ID=your-alibaba-access-key-id
ALIBABA_CLOUD_ACCESS_KEY_SECRET=your-alibaba-access-key-secret
SMS_SIGN_NAME=æ™ºæ…§å°åŒº
SMS_TEMPLATE_CODE=your-sms-template-code

# æ–‡ä»¶ä¸Šä¼ é…ç½®
UPLOAD_DIR=./uploads
MAX_FILE_SIZE=5242880
LOG_LEVEL=info
```

## ğŸš€ éƒ¨ç½²æ­¥éª¤

### ç¬¬ä¸€æ­¥ï¼šå‡†å¤‡ä»£ç 

#### 1. è¿è¡Œéƒ¨ç½²å‡†å¤‡è„šæœ¬
```bash
# åœ¨é¡¹ç›®æ ¹ç›®å½•è¿è¡Œ
./scripts/deploy-to-render.sh
```

è¿™ä¸ªè„šæœ¬ä¼šï¼š
- æ£€æŸ¥é¡¹ç›®ç»“æ„å’Œä¾èµ–
- åˆ›å»ºç”Ÿäº§ç¯å¢ƒé…ç½®æ–‡ä»¶
- æ£€æŸ¥GitçŠ¶æ€å¹¶æ¨é€ä»£ç åˆ°GitHub
- æ˜¾ç¤ºè¯¦ç»†çš„éƒ¨ç½²æŒ‡å—

#### 2. æ‰‹åŠ¨æ¨é€ä»£ç ï¼ˆå¦‚æœè„šæœ¬æœªè‡ªåŠ¨æ¨é€ï¼‰
```bash
git add .
git commit -m "å‡†å¤‡çº¿ä¸Šéƒ¨ç½²é…ç½®"
git push origin main
```

### ç¬¬äºŒæ­¥ï¼šéƒ¨ç½²åç«¯æœåŠ¡

#### 1. åˆ›å»ºWeb Service
1. ç™»å½• [Render.com](https://render.com)
2. ç‚¹å‡» "New +" â†’ "Web Service"
3. è¿æ¥æ‚¨çš„GitHubä»“åº“
4. é€‰æ‹©æ™ºæ…§å°åŒºç”Ÿæ´»å¹³å°é¡¹ç›®

#### 2. é…ç½®Web Service
```yaml
Name: smart-community-backend
Environment: Node
Region: Oregon (US West)
Branch: main
Root Directory: backend
Build Command: npm install && npm run build
Start Command: npm start
```

#### 3. é…ç½®ç¯å¢ƒå˜é‡
åœ¨Renderæ§åˆ¶å°çš„Environmenté¡µé¢æ·»åŠ ä»¥ä¸‹å˜é‡ï¼š

```bash
NODE_ENV=production
PORT=3000
JWT_SECRET=your-super-secret-jwt-key-change-in-production
JWT_EXPIRES_IN=7d
DATABASE_PATH=./data/smart-community.db
FRONTEND_URL=https://your-frontend-url.onrender.com

# é‚®ç®±é…ç½®
EMAIL_HOST=smtp.qq.com
EMAIL_PORT=587
EMAIL_SECURE=false
EMAIL_USER=your-qq-email@qq.com
EMAIL_PASS=your-qq-smtp-password
EMAIL_FROM=your-qq-email@qq.com
EMAIL_ENABLED=true

# çŸ­ä¿¡é…ç½®
SMS_ENABLED=true
SMS_PROVIDER=aliyun
ALIBABA_CLOUD_ACCESS_KEY_ID=your-alibaba-access-key-id
ALIBABA_CLOUD_ACCESS_KEY_SECRET=your-alibaba-access-key-secret
SMS_SIGN_NAME=æ™ºæ…§å°åŒº
SMS_TEMPLATE_CODE=your-sms-template-code

# å…¶ä»–é…ç½®
UPLOAD_DIR=./uploads
MAX_FILE_SIZE=5242880
LOG_LEVEL=info
```

#### 4. éƒ¨ç½²åç«¯
ç‚¹å‡» "Create Web Service" å¼€å§‹éƒ¨ç½²ã€‚éƒ¨ç½²å®Œæˆåï¼Œæ‚¨ä¼šå¾—åˆ°ä¸€ä¸ªåç«¯URLï¼Œç±»ä¼¼ï¼š
`https://smart-community-backend-xxx.onrender.com`

### ç¬¬ä¸‰æ­¥ï¼šéƒ¨ç½²å‰ç«¯æœåŠ¡

#### 1. åˆ›å»ºStatic Site
1. åœ¨Renderæ§åˆ¶å°ç‚¹å‡» "New +" â†’ "Static Site"
2. è¿æ¥åŒä¸€ä¸ªGitHubä»“åº“
3. é€‰æ‹©æ™ºæ…§å°åŒºç”Ÿæ´»å¹³å°é¡¹ç›®

#### 2. é…ç½®Static Site
```yaml
Name: smart-community-frontend
Branch: main
Root Directory: frontend
Build Command: npm install && npm run build
Publish Directory: dist
```

#### 3. é…ç½®ç¯å¢ƒå˜é‡
```bash
VITE_API_BASE_URL=https://your-backend-url.onrender.com/api
VITE_APP_NAME=æ™ºæ…§å°åŒºç”Ÿæ´»å¹³å°
```

#### 4. éƒ¨ç½²å‰ç«¯
ç‚¹å‡» "Create Static Site" å¼€å§‹éƒ¨ç½²ã€‚

### ç¬¬å››æ­¥ï¼šæ›´æ–°CORSé…ç½®

éƒ¨ç½²å®Œæˆåï¼Œéœ€è¦æ›´æ–°åç«¯çš„CORSé…ç½®ï¼š

1. è·å–å‰ç«¯URLï¼ˆç±»ä¼¼ï¼š`https://smart-community-frontend-xxx.onrender.com`ï¼‰
2. åœ¨Renderåç«¯æœåŠ¡çš„ç¯å¢ƒå˜é‡ä¸­æ›´æ–°ï¼š
   ```bash
   FRONTEND_URL=https://your-actual-frontend-url.onrender.com
   ```
3. é‡æ–°éƒ¨ç½²åç«¯æœåŠ¡

### ç¬¬äº”æ­¥ï¼šé…ç½®è‡ªå®šä¹‰åŸŸåï¼ˆå¯é€‰ï¼‰

#### 1. åç«¯è‡ªå®šä¹‰åŸŸå
1. åœ¨Renderåç«¯æœåŠ¡è®¾ç½®ä¸­ç‚¹å‡» "Custom Domains"
2. æ·»åŠ æ‚¨çš„åŸŸåï¼ˆå¦‚ï¼š`api.yourdomain.com`ï¼‰
3. é…ç½®DNS CNAMEè®°å½•æŒ‡å‘Renderæä¾›çš„åœ°å€

#### 2. å‰ç«¯è‡ªå®šä¹‰åŸŸå
1. åœ¨Renderå‰ç«¯æœåŠ¡è®¾ç½®ä¸­ç‚¹å‡» "Custom Domains"
2. æ·»åŠ æ‚¨çš„åŸŸåï¼ˆå¦‚ï¼š`yourdomain.com`ï¼‰
3. é…ç½®DNSè®°å½•

## ğŸ§ª æµ‹è¯•éƒ¨ç½²

### 1. å¥åº·æ£€æŸ¥
è®¿é—®åç«¯å¥åº·æ£€æŸ¥ç«¯ç‚¹ï¼š
```
https://your-backend-url.onrender.com/health
```

### 2. å‰ç«¯è®¿é—®
è®¿é—®å‰ç«¯åº”ç”¨ï¼š
```
https://your-frontend-url.onrender.com
```

### 3. APIæµ‹è¯•
æµ‹è¯•é‚®ç®±éªŒè¯ç åŠŸèƒ½ï¼š
```bash
curl -X POST https://your-backend-url.onrender.com/api/auth/send-verification-code \
  -H "Content-Type: application/json" \
  -d '{"identifier":"test@example.com","type":"email"}'
```

## ğŸ”§ è¿ç»´ç®¡ç†

### 1. ç›‘æ§å’Œæ—¥å¿—
- **Renderæ§åˆ¶å°**: æŸ¥çœ‹éƒ¨ç½²çŠ¶æ€ã€æ—¥å¿—å’Œæ€§èƒ½æŒ‡æ ‡
- **å¥åº·æ£€æŸ¥**: å®šæœŸè®¿é—® `/health` ç«¯ç‚¹
- **é”™è¯¯ç›‘æ§**: æŸ¥çœ‹Renderæä¾›çš„é”™è¯¯æ—¥å¿—

### 2. è‡ªåŠ¨éƒ¨ç½²
- æ¨é€åˆ°GitHub mainåˆ†æ”¯ä¼šè‡ªåŠ¨è§¦å‘é‡æ–°éƒ¨ç½²
- å¯ä»¥åœ¨Renderæ§åˆ¶å°æ‰‹åŠ¨è§¦å‘éƒ¨ç½²
- æ”¯æŒå›æ»šåˆ°ä¹‹å‰çš„éƒ¨ç½²ç‰ˆæœ¬

### 3. æ•°æ®å¤‡ä»½
ç”±äºä½¿ç”¨SQLiteæ–‡ä»¶æ•°æ®åº“ï¼Œå»ºè®®ï¼š
- å®šæœŸä¸‹è½½æ•°æ®åº“æ–‡ä»¶å¤‡ä»½
- ä½¿ç”¨GitHubå­˜å‚¨é‡è¦é…ç½®
- è€ƒè™‘å‡çº§åˆ°PostgreSQLï¼ˆRenderå…è´¹æä¾›ï¼‰

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–

### 1. å…è´¹è®¡åˆ’é™åˆ¶
- **ä¼‘çœ æœºåˆ¶**: 15åˆ†é’Ÿæ— æ´»åŠ¨åæœåŠ¡ä¼šä¼‘çœ 
- **å¯åŠ¨æ—¶é—´**: ä¼‘çœ åé¦–æ¬¡è®¿é—®éœ€è¦30-60ç§’å¯åŠ¨
- **å¸¦å®½é™åˆ¶**: æ¯æœˆ100GBæµé‡
- **æ„å»ºæ—¶é—´**: æ¯æœˆ750å°æ—¶å…è´¹

### 2. ä¼˜åŒ–å»ºè®®
- ä½¿ç”¨CDNåŠ é€Ÿé™æ€èµ„æº
- å¯ç”¨Gzipå‹ç¼©
- ä¼˜åŒ–å›¾ç‰‡å’Œèµ„æºå¤§å°
- å®ç°é€‚å½“çš„ç¼“å­˜ç­–ç•¥

### 3. å‡çº§é€‰é¡¹
å¦‚éœ€æ›´å¥½æ€§èƒ½ï¼Œå¯è€ƒè™‘ï¼š
- å‡çº§åˆ°Renderä»˜è´¹è®¡åˆ’
- ä½¿ç”¨ä¸“ç”¨æ•°æ®åº“æœåŠ¡
- é…ç½®è‡ªå®šä¹‰åŸŸåå’ŒSSL

## ğŸ” å®‰å…¨é…ç½®

### 1. ç¯å¢ƒå˜é‡å®‰å…¨
- æ‰€æœ‰æ•æ„Ÿä¿¡æ¯é€šè¿‡ç¯å¢ƒå˜é‡é…ç½®
- ä¸åœ¨ä»£ç ä¸­ç¡¬ç¼–ç å¯†é’¥
- å®šæœŸæ›´æ¢JWTå¯†é’¥å’ŒAPIå¯†é’¥

### 2. HTTPSé…ç½®
- Renderè‡ªåŠ¨æä¾›HTTPS
- å¼ºåˆ¶HTTPSé‡å®šå‘
- ç°ä»£TLSé…ç½®

### 3. CORSé…ç½®
- ä¸¥æ ¼é…ç½®å…è®¸çš„å‰ç«¯åŸŸå
- ä¸ä½¿ç”¨é€šé…ç¬¦ `*`
- å®šæœŸå®¡æŸ¥CORSè®¾ç½®

## ğŸ› ï¸ å¸¸è§é—®é¢˜è§£å†³

### 1. éƒ¨ç½²å¤±è´¥
**é—®é¢˜**: æ„å»ºæˆ–å¯åŠ¨å¤±è´¥
**è§£å†³æ–¹æ¡ˆ**:
- æ£€æŸ¥æ„å»ºæ—¥å¿—ä¸­çš„é”™è¯¯ä¿¡æ¯
- ç¡®è®¤æ‰€æœ‰ä¾èµ–éƒ½åœ¨ `package.json` ä¸­
- éªŒè¯ç¯å¢ƒå˜é‡é…ç½®
- æ£€æŸ¥Node.jsç‰ˆæœ¬å…¼å®¹æ€§

### 2. æœåŠ¡ä¼‘çœ 
**é—®é¢˜**: 15åˆ†é’ŸåæœåŠ¡ä¼‘çœ ï¼Œè®¿é—®ç¼“æ…¢
**è§£å†³æ–¹æ¡ˆ**:
- å®ç°å¥åº·æ£€æŸ¥å®šæ—¶å™¨
- è€ƒè™‘å‡çº§åˆ°ä»˜è´¹è®¡åˆ’
- ä½¿ç”¨å¤–éƒ¨ç›‘æ§æœåŠ¡ä¿æŒæ´»è·ƒ

### 3. æ•°æ®åº“é—®é¢˜
**é—®é¢˜**: SQLiteæ–‡ä»¶ä¸¢å¤±æˆ–æŸå
**è§£å†³æ–¹æ¡ˆ**:
- å®ç°å®šæœŸå¤‡ä»½æœºåˆ¶
- è€ƒè™‘è¿ç§»åˆ°PostgreSQL
- ä½¿ç”¨æŒä¹…åŒ–å­˜å‚¨å·

### 4. CORSé”™è¯¯
**é—®é¢˜**: å‰ç«¯æ— æ³•è®¿é—®åç«¯API
**è§£å†³æ–¹æ¡ˆ**:
- æ£€æŸ¥ `FRONTEND_URL` ç¯å¢ƒå˜é‡
- ç¡®è®¤åŸŸåé…ç½®æ­£ç¡®
- æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°é”™è¯¯

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœåœ¨éƒ¨ç½²è¿‡ç¨‹ä¸­é‡åˆ°é—®é¢˜ï¼Œè¯·ï¼š

1. æŸ¥çœ‹Renderæ§åˆ¶å°çš„éƒ¨ç½²æ—¥å¿—
2. æ£€æŸ¥ç¯å¢ƒå˜é‡é…ç½®
3. éªŒè¯GitHubä»£ç æ˜¯å¦æœ€æ–°
4. å‚è€ƒæœ¬æ–‡æ¡£çš„å¸¸è§é—®é¢˜éƒ¨åˆ†

## ğŸ”— ç›¸å…³é“¾æ¥

- [Renderå®˜æ–¹æ–‡æ¡£](https://render.com/docs)
- [Node.jséƒ¨ç½²æŒ‡å—](https://render.com/docs/node-express-app)
- [é™æ€ç«™ç‚¹éƒ¨ç½²](https://render.com/docs/static-sites)
- [ç¯å¢ƒå˜é‡é…ç½®](https://render.com/docs/environment-variables)

---

**æ³¨æ„**: 
- å…è´¹è®¡åˆ’æœ‰ä¸€å®šé™åˆ¶ï¼Œé€‚åˆå¼€å‘å’Œå°è§„æ¨¡ä½¿ç”¨
- ç”Ÿäº§ç¯å¢ƒå»ºè®®ä½¿ç”¨ä»˜è´¹è®¡åˆ’ä»¥è·å¾—æ›´å¥½æ€§èƒ½
- å®šæœŸå¤‡ä»½é‡è¦æ•°æ®
- ç›‘æ§æœåŠ¡çŠ¶æ€å’Œæ€§èƒ½æŒ‡æ ‡ 